{% extends 'encomendas/base.html' %}

{% block title %}Encomenda #{{ encomenda.numero_encomenda }} - Sistema de Encomendas{% endblock %}

{% block extra_css %}
<style>
    .encomenda-header {
        background: linear-gradient(135deg, var(--primary-color) 0%, #1e3a8a 100%);
        color: white;
        border-radius: 12px;
        padding: 30px;
        margin-bottom: 30px;
    }
    
    .formulario-fisico {
        background: white;
        border: 2px solid #333;
        padding: 20px;
        font-family: 'Courier New', monospace;
        box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        position: relative;
    }
    
    .formulario-header {
        text-align: center;
        border-bottom: 2px solid #333;
        padding-bottom: 10px;
        margin-bottom: 15px;
    }
    
    .logo-area {
        display: flex;
        align-items: center;
        justify-content: space-between;
        margin-bottom: 10px;
    }
    
    .numero-encomenda {
        border: 2px solid #333;
        padding: 8px 12px;
        font-size: 1.4em;
        font-weight: bold;
    }
    
    .campo-formulario {
        display: flex;
        align-items: flex-end;
        border-bottom: 1px dotted #666;
        padding-bottom: 3px;
        margin-bottom: 12px;
        min-height: 28px;
    }
    
    .campo-label {
        font-weight: bold;
        margin-right: 8px;
        white-space: nowrap;
    }
    
    .campo-valor {
        flex: 1;
        font-family: inherit;
        font-size: 0.95em;
    }
    
    .secao-destaque {
        border: 2px solid #333;
        padding: 15px;
        margin-top: 20px;
    }
    
    .tabela-itens {
        width: 100%;
        border-collapse: collapse;
        margin: 20px 0;
        font-size: 0.9em;
    }
    
    .tabela-itens th,
    .tabela-itens td {
        border: 1px solid #333;
        padding: 6px;
        text-align: left;
    }
    
    .tabela-itens th {
        background: #e9ecef;
    }
    
    @media print {
        .no-print { display: none !important; }
        body { background: white !important; -webkit-print-color-adjust: exact; }
        .formulario-fisico { 
            border: 2px solid #000 !important;
            box-shadow: none !important;
            page-break-inside: avoid;
        }
        .main-content { padding: 0 !important; }
    }
</style>
{% endblock %}

{% block content %}
<div class="no-print">
    <div class="encomenda-header">
        <div class="d-flex justify-content-between align-items-center">
            <div>
                <h1><i class="bi bi-clipboard-data me-3"></i>Encomenda #{{ encomenda.numero_encomenda }}</h1>
                <p class="mb-0">{{ encomenda.cliente.nome }}</p>
            </div>
            <div class="text-end">
                <span class="status-badge status-{{ encomenda.status }}">
                    {{ encomenda.get_status_display }}
                </span>
                <div class="mt-2">
                    <small>Criada em {{ encomenda.data_criacao|date:"d/m/Y H:i" }}</small>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="card no-print mb-4">
    <div class="card-body">
        <div class="d-flex flex-wrap gap-2 justify-content-between align-items-center">
            <div class="d-flex flex-wrap gap-2">
                <a href="{% url 'encomenda_list' %}" class="btn btn-secondary">
                    <i class="bi bi-arrow-left me-2"></i>Voltar para Lista
                </a>
                <a href="{% url 'encomenda_edit' encomenda.pk %}" class="btn btn-primary">
                    <i class="bi bi-pencil me-2"></i>Editar Encomenda
                </a>
            </div>
            <div class="d-flex flex-wrap gap-2">
                {% if not entrega %}
                <a href="{% url 'entrega_create' encomenda.pk %}" class="btn btn-success">
                    <i class="bi bi-truck me-2"></i>Programar Entrega
                </a>
                {% else %}
                <a href="{% url 'entrega_edit' entrega.pk %}" class="btn btn-info">
                    <i class="bi bi-truck me-2"></i>Ver / Editar Entrega
                </a>
                {% endif %}
                <button onclick="window.print()" class="btn btn-outline-primary">
                    <i class="bi bi-printer me-2"></i>Imprimir
                </button>
                <a href="{% url 'encomenda_delete' encomenda.pk %}" class="btn btn-outline-danger">
                    <i class="bi bi-trash me-2"></i>Excluir
                </a>
            </div>
        </div>
    </div>
</div>

<div class="formulario-fisico">
    <div class="formulario-header">
        <div class="logo-area">
            <div>
                <h4 style="margin: 0; background: #333; color: white; padding: 2px 5px; display: inline-block;">BLOCO DE ENCOMENDAS</h4>
                <h3 style="margin: 5px 0; color: #2c5aa0;"><strong>+B</strong> DROGARIA Benfica</h3>
                <p style="margin: 0; font-size: 0.8em;">Entrega em toda Juiz de Fora</p>
                <p style="margin: 0; font-size: 0.7em;">📞 32 99994-3178 📞 32 3112-3999 | 3272-8532</p>
            </div>
            <div class="numero-encomenda">{{ encomenda.numero_encomenda }}</div>
        </div>
        <div style="display: flex; justify-content: space-between;">
            <div class="campo-formulario" style="border:none; width: 45%;">
                <span class="campo-label">Data:</span>
                <span class="campo-valor">{{ encomenda.data_encomenda|date:"d/m/Y" }}</span>
            </div>
            <div class="campo-formulario" style="border:none; width: 50%;">
                <span class="campo-label">Responsável:</span>
                <span class="campo-valor">{{ encomenda.responsavel_criacao }}</span>
            </div>
        </div>
    </div>

    <table class="tabela-itens">
        <thead>
            <tr>
                <th>Produto</th>
                <th>Cód.</th>
                <th>Fornecedor</th>
                <th>Qtd</th>
                <th>Preço Cotado</th>
                <th>Total Item</th>
            </tr>
        </thead>
        <tbody>
            {% for item in itens %}
            <tr>
                <td>{{ item.produto.nome }}</td>
                <td>{{ item.produto.codigo }}</td>
                <td>{{ item.fornecedor.nome }}</td>
                <td style="text-align: center;">{{ item.quantidade }}</td>
                <td>R$ {{ item.preco_cotado|floatformat:2 }}</td>
                <td>R$ {{ item.valor_total|floatformat:2 }}</td>
            </tr>
            {% empty %}
            <tr><td colspan="6">Nenhum item nesta encomenda.</td></tr>
            {% endfor %}
        </tbody>
    </table>
    
    <div class="campo-formulario"><span class="campo-label">Nome do Cliente:</span><span class="campo-valor">{{ encomenda.cliente.nome }}</span></div>
    <div class="campo-formulario"><span class="campo-label">Código:</span><span class="campo-valor">{{ encomenda.cliente.codigo }}</span></div>
    <div class="campo-formulario"><span class="campo-label">End.:</span><span class="campo-valor">{{ encomenda.cliente.endereco }}</span></div>
    <div style="display: flex; gap: 20px;">
        <div class="campo-formulario" style="flex: 1;"><span class="campo-label">Bairro:</span><span class="campo-valor">{{ encomenda.cliente.bairro }}</span></div>
        <div class="campo-formulario" style="flex: 1;"><span class="campo-label">Referência:</span><span class="campo-valor">{{ encomenda.cliente.referencia|default:"" }}</span></div>
    </div>
    
    <div class="campo-formulario"><span class="campo-label">Valor Pago Adiantamento:</span><span class="campo-valor">{% if entrega %}R$ {{ entrega.valor_pago_adiantamento|floatformat:2 }}{% endif %}</span></div>
    <div class="campo-formulario"><span class="campo-label">Data Entrega:</span><span class="campo-valor">{% if entrega %}{{ entrega.data_entrega|date:"d / m / Y" }}{% endif %}</span></div>
    <div class="campo-formulario"><span class="campo-label">Observação:</span><span class="campo-valor">{{ encomenda.observacoes|default:"" }}</span></div>
    
    <div class="campo-formulario"><span class="campo-label">Responsável Entrega:</span><span class="campo-valor">{{ entrega.responsavel_entrega|default:"" }}</span></div>
    <div style="display: flex; gap: 20px;">
        <div class="campo-formulario" style="flex: 1;"><span class="campo-label">Data:</span><span class="campo-valor">{% if entrega.data_entrega_realizada %}{{ entrega.data_entrega_realizada|date:"d / m / Y" }}{% endif %}</span></div>
        <div class="campo-formulario" style="flex: 1;"><span class="campo-label">Hora:</span><span class="campo-valor">{% if entrega.hora_entrega %}{{ entrega.hora_entrega|time:"H:i" }}{% endif %}</span></div>
    </div>
    <div class="campo-formulario" style="height: 40px;"><span class="campo-label">Ass. do Cliente:</span><span class="campo-valor">{{ entrega.assinatura_cliente|default:"" }}</span></div>

    <div class="secao-destaque">
        <div style="display:flex; justify-content: space-between; align-items:flex-start; margin-bottom: 10px;">
            <div style="flex:1;">
                <div class="campo-formulario"><span class="campo-label">Responsável pela Encomenda:</span><span class="campo-valor">{{ encomenda.responsavel_criacao }}</span></div>
                <div class="campo-formulario"><span class="campo-label">Valor do Adiantamento:</span><span class="campo-valor">{% if entrega %}R$ {{ entrega.valor_pago_adiantamento|floatformat:2 }}{% endif %}</span></div>
                <div style="display: flex; gap: 20px;">
                    <div class="campo-formulario" style="flex: 1;"><span class="campo-label">Data:</span><span class="campo-valor">{% if entrega.data_entrega_realizada %}{{ entrega.data_entrega_realizada|date:"d/m/Y" }}{% endif %}</span></div>
                    <div class="campo-formulario" style="flex: 1;"><span class="campo-label">Hora:</span><span class="campo-valor">{% if entrega.hora_entrega %}{{ entrega.hora_entrega|time:"H:i" }}{% endif %}</span></div>
                </div>
                <div class="campo-formulario"><span class="campo-label">Valor do Produto:</span><span class="campo-valor">R$ {{ encomenda.valor_total|floatformat:2 }}</span></div>
                <div class="campo-formulario"><span class="campo-label">Entregue por:</span><span class="campo-valor">{{ entrega.entregue_por|default:"" }}</span></div>
            </div>
            <div class="numero-encomenda" style="margin-left: 20px; color: red; border-color: red;">{{ encomenda.numero_encomenda }}</div>
        </div>
    </div>

    <div style="text-align: right; margin-top: 10px; font-size: 0.7em;">
        1001 Artes Gráficas (32) 3261-1001
    </div>
</div>
{% endblock %}